mean_gender_scale = mean(gender_scale, na.rm = TRUE)
) %>%
drop_na()
scaled_features <- speaker_features %>%
select(percent_reported_black) %>%
scale()
set.seed(123)  # for reproducibility
km <- kmeans(scaled_features, centers = 3, nstart = 50)
speaker_clusters <- speaker_features %>%
mutate(cluster = factor(km$cluster))
cluster_means <- speaker_clusters %>%
group_by(cluster) %>%
summarise(mean_black = mean(percent_reported_black))
cluster_means
ggplot(speaker_clusters,
aes(x = percent_reported_black,
y = cluster,
color = cluster)) +
geom_jitter(height = 0.1, size = 4, alpha = 0.9) +
scale_color_manual(values = c(
"#2b7de9",
"#c23b23",
"gray40"
)) +
labs(
x = "% Reported Black",
y = "Cluster",
color = "Cluster",
#title = "K-means Clustering on % Reported Black (k = 3)"
) +
theme_minimal(base_size = 14)
# crete ground truth label based on cluster assignment
# Create labeled cluster categories
cluster_labels <- speaker_clusters %>%
mutate(
ground_truth_label = case_when(
cluster == 1 ~ "White",
cluster == 2 ~ "Black",
cluster == 3 ~ "Ambiguous"
)
) %>%
select(speaker, ground_truth_label)
# Join back to main df
df <- df %>%
left_join(cluster_labels, by = "speaker")
view(df)
df$ground_truth_label
# create cluster-base density plot
df %>%
distinct(speaker, percent_reported_black, ground_truth_label) %>%
filter(!is.na(percent_reported_black),
!is.na(ground_truth_label)) %>%
ggplot(aes(x = percent_reported_black,
fill = ground_truth_label,
color = ground_truth_label)) +
geom_density(alpha = 0.3, linewidth = 1.2) +
scale_fill_manual(values = c(
"Black"      = "#c23b23",
"White"      = "#2b7de9",
"Ambiguous"  = "gray40"
)) +
scale_color_manual(values = c(
"Black"      = "#c23b23",
"White"      = "#2b7de9",
"Ambiguous"  = "gray40"
)) +
scale_x_continuous(limits = c(0, 100), expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
labs(
x = "% Reported Black",
y = "Density",
fill = "Ground Truth Label",
color = "Ground Truth Label"
) +
theme_minimal(base_size = 14) +
theme(
panel.grid = element_blank(),
panel.background = element_rect(fill = "white", color = NA),
plot.background = element_rect(fill = "white", color = NA),
axis.line = element_line(color = "black", linewidth = 0.9),
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black")
)
install.packages("ggridges")
library(ggridges)
library(tidyverse)
library(factoextra)
library(ggridges)
# Load data
df <- read_csv("/Users/noahkhaloo/Desktop/TTS_perception/data/survey_results/survey_results.csv")
# Standard error function
se <- function(x) sd(x, na.rm = TRUE) / sqrt(sum(!is.na(x)))
# RACE AGREEMENT
agreement_by_category_and_speaker <- df %>%
filter(!is.na(speaker), block == "Race") %>%
mutate(
speaker_category = str_sub(speaker, 1, 2),
true_race = case_when(
str_starts(speaker, "B") ~ "Black",
str_starts(speaker, "W") ~ "White"
),
agreement = perceived_race == true_race
) %>%
group_by(speaker_category, speaker) %>%
summarise(
percent_agreement = mean(agreement, na.rm = TRUE) * 100,
se = se(agreement) * 100,
.groups = "drop"
)
# Category-level summary WITH SE
agreement_by_category <- agreement_by_category_and_speaker %>%
group_by(speaker_category) %>%
summarise(
category_percent_agreement = mean(percent_agreement),
se = se(percent_agreement),
.groups = "drop"
)
# PLOT 1: Category Agreement + SE
ggplot(agreement_by_category,
aes(x = speaker_category,
y = category_percent_agreement,
fill = speaker_category)) +
geom_col(width = 0.6, color = "black") +
geom_errorbar(aes(ymin = category_percent_agreement - se,
ymax = category_percent_agreement + se),
width = 0.15, linewidth = 0.8) +
geom_text(aes(label = sprintf("%.1f%%", category_percent_agreement),
y = category_percent_agreement + se + 3),
vjust = 0, size = 4.5) +
scale_fill_manual(values = c("BF" = "#c23b23",
"BM" = "#6f42c1",
"WF" = "#2b7de9",
"WM" = "#28a745")) +
labs(x = "Speaker Category", y = "Agreement with label") +
scale_y_continuous(expand = expansion(mult = c(0, 0))) +
scale_x_discrete(expand = expansion(mult = 0.2)) +
coord_cartesian(ylim = c(0, 100)) +
theme_minimal(base_size = 14) +
theme(
legend.position = "none",
axis.line = element_line(color = "black"),
panel.grid = element_blank(),
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black")
)
# GENDER AGREEMENT
gender_agreement_race_gender <- df %>%
filter(!is.na(gender_scale), !is.na(speaker)) %>%
mutate(
true_gender = if_else(str_sub(speaker, 2, 2) == "F", "Female", "Male"),
true_race = if_else(str_sub(speaker, 1, 1) == "B", "Black", "White"),
perceived_gender = if_else(gender_scale >= 4, "Male", "Female"),
agree = perceived_gender == true_gender
) %>%
group_by(true_race, true_gender) %>%
summarise(
percent_agreement = mean(agree) * 100,
sd_agreement = sd(as.numeric(agree)) * 100,
n = n(),
.groups = "drop"
)
# add %Reported Black
df <- df %>%
group_by(speaker) %>%
mutate(percent_reported_black =
mean(perceived_race == "Black", na.rm = TRUE) * 100) %>%
ungroup()
# Density distribution of %Reported Black
df %>%
distinct(speaker, percent_reported_black) %>%
filter(!is.na(speaker), !is.na(percent_reported_black)) %>%
mutate(category = substr(speaker, 1, 2)) %>%
ggplot(aes(x = percent_reported_black,
fill = category,
color = category)) +
geom_density(alpha = 0.3, linewidth = 1.2) +
scale_fill_manual(values = c(
"BF" = "#c23b23",
"BM" = "#6f42c1",
"WF" = "#2b7de9",
"WM" = "#28a745"
)) +
scale_color_manual(values = c(
"BF" = "#c23b23",
"BM" = "#6f42c1",
"WF" = "#2b7de9",
"WM" = "#28a745"
)) +
# X axis starts at 0
scale_x_continuous(limits = c(0, 100), expand = c(0, 0)) +
# Make densities touch the x-axis
scale_y_continuous(expand = c(0, 0)) +
labs(
x = "% Reported Black",
y = "Density"
) +
theme_minimal(base_size = 14) +
theme(
panel.grid = element_blank(),
panel.background = element_rect(fill = "white", color = NA),
plot.background = element_rect(fill = "white", color = NA),
axis.line = element_line(color = "black", linewidth = 0.9),
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black")
)
# k means
speaker_features <- df %>%
group_by(speaker) %>%
summarise(
percent_reported_black = mean(perceived_race == "Black", na.rm = TRUE) * 100,
mean_gender_scale = mean(gender_scale, na.rm = TRUE)
) %>%
drop_na()
scaled_features <- speaker_features %>%
select(percent_reported_black) %>%
scale()
set.seed(123)  # for reproducibility
km <- kmeans(scaled_features, centers = 3, nstart = 50)
speaker_clusters <- speaker_features %>%
mutate(cluster = factor(km$cluster))
cluster_means <- speaker_clusters %>%
group_by(cluster) %>%
summarise(mean_black = mean(percent_reported_black))
cluster_means
ggplot(speaker_clusters,
aes(x = percent_reported_black,
y = cluster,
color = cluster)) +
geom_jitter(height = 0.1, size = 4, alpha = 0.9) +
scale_color_manual(values = c(
"#2b7de9",
"#c23b23",
"gray40"
)) +
labs(
x = "% Reported Black",
y = "Cluster",
color = "Cluster",
#title = "K-means Clustering on % Reported Black (k = 3)"
) +
theme_minimal(base_size = 14)
# crete ground truth label based on cluster assignment
# Create labeled cluster categories
cluster_labels <- speaker_clusters %>%
mutate(
ground_truth_label = case_when(
cluster == 1 ~ "White",
cluster == 2 ~ "Black",
cluster == 3 ~ "Ambiguous"
)
) %>%
select(speaker, ground_truth_label)
# Join back to main df
df <- df %>%
left_join(cluster_labels, by = "speaker")
# create cluster-base density plot
df_plot <- df %>%
distinct(speaker, percent_reported_black, ground_truth_label) %>%
filter(!is.na(percent_reported_black),
!is.na(ground_truth_label))
ggplot(df_plot,
aes(x = percent_reported_black,
y = ground_truth_label,
fill = ground_truth_label)) +
geom_density_ridges(
alpha = 0.35,
color = NA,
scale = 1.5
) +
scale_fill_manual(values = c(
"Black"      = "#c23b23",
"White"      = "#2b7de9",
"Ambiguous"  = "gray40"
)) +
scale_x_continuous(limits = c(0, 100), expand = c(0, 0)) +
labs(
x = NULL,
y = NULL
) +
theme_minimal(base_size = 16) +
theme(
legend.position = "none",
panel.grid = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_text(size = 14),
axis.title.x = element_blank(),
axis.line.x = element_line(color = "black", linewidth = 1.1),
plot.margin = margin(20, 20, 40, 20)
) +
# Add the long baseline with arrows like your figure
annotate("segment", x = 0,   xend = 100, y = -0.8, yend = -0.8,
linewidth = 1.5, color = "black") +
annotate("segment", x = 0,   xend = -5,  y = -0.8, yend = -0.8,
arrow = arrow(length = unit(0.25, "cm")), linewidth = 1.2) +
annotate("segment", x = 100, xend = 105, y = -0.8, yend = -0.8,
arrow = arrow(length = unit(0.25, "cm")), linewidth = 1.2) +
# Add the text labels like your sample figure
annotate("text", x = 0,   y = -1.1, label = "More Black-like", hjust = 0, size = 5) +
annotate("text", x = 50,  y = -1.1, label = "Ambiguous / GNC-like", hjust = 0.5, size = 5) +
annotate("text", x = 100, y = -1.1, label = "More White-like", hjust = 1, size = 5)
ggplot(df_plot,
aes(x = percent_reported_black,
y = ground_truth_label,
fill = ground_truth_label)) +
geom_density_ridges(
alpha = 0.35,
color = NA,
scale = 1.5
) +
scale_fill_manual(values = c(
"Black"      = "#c23b23",
"White"      = "#2b7de9",
"Ambiguous"  = "gray40"
)) +
scale_x_continuous(limits = c(0, 100), expand = c(0, 0)) +
labs(
x = NULL,
y = NULL
) +
theme_minimal(base_size = 16) +
theme(
legend.position = "none",
panel.grid = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_text(size = 14),
axis.title.x = element_blank(),
axis.line.x = element_line(color = "black", linewidth = 1.1),
plot.margin = margin(20, 20, 40, 20)
) +
# Add the long baseline with arrows like your figure
annotate("segment", x = 0,   xend = 100, y = -0.8, yend = -0.8,
linewidth = 1.5, color = "black") +
annotate("segment", x = 0,   xend = -5,  y = -0.8, yend = -0.8,
arrow = arrow(length = unit(0.25, "cm")), linewidth = 1.2) +
annotate("segment", x = 100, xend = 105, y = -0.8, yend = -0.8,
arrow = arrow(length = unit(0.25, "cm")), linewidth = 1.2) +
# Add the text labels like your sample figure
annotate("text", x = 0,   y = -1.1, label = "More Black-like", hjust = 0, size = 5) +
annotate("text", x = 50,  y = -1.1, label = "Ambiguous / GNC-like", hjust = 0.5, size = 5) +
annotate("text", x = 100, y = -1.1, label = "More White-like", hjust = 1, size = 5)
library(tidyverse)
library(factoextra)
library(ggridges)
# Load data
df <- read_csv("/Users/noahkhaloo/Desktop/TTS_perception/data/survey_results/survey_results.csv")
# Standard error function
se <- function(x) sd(x, na.rm = TRUE) / sqrt(sum(!is.na(x)))
# RACE AGREEMENT
agreement_by_category_and_speaker <- df %>%
filter(!is.na(speaker), block == "Race") %>%
mutate(
speaker_category = str_sub(speaker, 1, 2),
true_race = case_when(
str_starts(speaker, "B") ~ "Black",
str_starts(speaker, "W") ~ "White"
),
agreement = perceived_race == true_race
) %>%
group_by(speaker_category, speaker) %>%
summarise(
percent_agreement = mean(agreement, na.rm = TRUE) * 100,
se = se(agreement) * 100,
.groups = "drop"
)
# Category-level summary WITH SE
agreement_by_category <- agreement_by_category_and_speaker %>%
group_by(speaker_category) %>%
summarise(
category_percent_agreement = mean(percent_agreement),
se = se(percent_agreement),
.groups = "drop"
)
# PLOT 1: Category Agreement + SE
ggplot(agreement_by_category,
aes(x = speaker_category,
y = category_percent_agreement,
fill = speaker_category)) +
geom_col(width = 0.6, color = "black") +
geom_errorbar(aes(ymin = category_percent_agreement - se,
ymax = category_percent_agreement + se),
width = 0.15, linewidth = 0.8) +
geom_text(aes(label = sprintf("%.1f%%", category_percent_agreement),
y = category_percent_agreement + se + 3),
vjust = 0, size = 4.5) +
scale_fill_manual(values = c("BF" = "#c23b23",
"BM" = "#6f42c1",
"WF" = "#2b7de9",
"WM" = "#28a745")) +
labs(x = "Speaker Category", y = "Agreement with label") +
scale_y_continuous(expand = expansion(mult = c(0, 0))) +
scale_x_discrete(expand = expansion(mult = 0.2)) +
coord_cartesian(ylim = c(0, 100)) +
theme_minimal(base_size = 14) +
theme(
legend.position = "none",
axis.line = element_line(color = "black"),
panel.grid = element_blank(),
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black")
)
# GENDER AGREEMENT
gender_agreement_race_gender <- df %>%
filter(!is.na(gender_scale), !is.na(speaker)) %>%
mutate(
true_gender = if_else(str_sub(speaker, 2, 2) == "F", "Female", "Male"),
true_race = if_else(str_sub(speaker, 1, 1) == "B", "Black", "White"),
perceived_gender = if_else(gender_scale >= 4, "Male", "Female"),
agree = perceived_gender == true_gender
) %>%
group_by(true_race, true_gender) %>%
summarise(
percent_agreement = mean(agree) * 100,
sd_agreement = sd(as.numeric(agree)) * 100,
n = n(),
.groups = "drop"
)
# add %Reported Black
df <- df %>%
group_by(speaker) %>%
mutate(percent_reported_black =
mean(perceived_race == "Black", na.rm = TRUE) * 100) %>%
ungroup()
# Density distribution of %Reported Black
df %>%
distinct(speaker, percent_reported_black) %>%
filter(!is.na(speaker), !is.na(percent_reported_black)) %>%
mutate(category = substr(speaker, 1, 2)) %>%
ggplot(aes(x = percent_reported_black,
fill = category,
color = category)) +
geom_density(alpha = 0.3, linewidth = 1.2) +
scale_fill_manual(values = c(
"BF" = "#c23b23",
"BM" = "#6f42c1",
"WF" = "#2b7de9",
"WM" = "#28a745"
)) +
scale_color_manual(values = c(
"BF" = "#c23b23",
"BM" = "#6f42c1",
"WF" = "#2b7de9",
"WM" = "#28a745"
)) +
# X axis starts at 0
scale_x_continuous(limits = c(0, 100), expand = c(0, 0)) +
# Make densities touch the x-axis
scale_y_continuous(expand = c(0, 0)) +
labs(
x = "% Reported Black",
y = "Density"
) +
theme_minimal(base_size = 14) +
theme(
panel.grid = element_blank(),
panel.background = element_rect(fill = "white", color = NA),
plot.background = element_rect(fill = "white", color = NA),
axis.line = element_line(color = "black", linewidth = 0.9),
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black")
)
# k means
speaker_features <- df %>%
group_by(speaker) %>%
summarise(
percent_reported_black = mean(perceived_race == "Black", na.rm = TRUE) * 100,
mean_gender_scale = mean(gender_scale, na.rm = TRUE)
) %>%
drop_na()
scaled_features <- speaker_features %>%
select(percent_reported_black) %>%
scale()
set.seed(123)  # for reproducibility
km <- kmeans(scaled_features, centers = 3, nstart = 50)
speaker_clusters <- speaker_features %>%
mutate(cluster = factor(km$cluster))
cluster_means <- speaker_clusters %>%
group_by(cluster) %>%
summarise(mean_black = mean(percent_reported_black))
cluster_means
ggplot(speaker_clusters,
aes(x = percent_reported_black,
y = cluster,
color = cluster)) +
geom_jitter(height = 0.1, size = 4, alpha = 0.9) +
scale_color_manual(values = c(
"#2b7de9",
"#c23b23",
"gray40"
)) +
labs(
x = "% Reported Black",
y = "Cluster",
color = "Cluster",
#title = "K-means Clustering on % Reported Black (k = 3)"
) +
theme_minimal(base_size = 14)
# crete ground truth label based on cluster assignment
# Create labeled cluster categories
cluster_labels <- speaker_clusters %>%
mutate(
ground_truth_label = case_when(
cluster == 1 ~ "White",
cluster == 2 ~ "Black",
cluster == 3 ~ "Ambiguous"
)
) %>%
select(speaker, ground_truth_label)
# Join back to main df
df <- df %>%
left_join(cluster_labels, by = "speaker")
