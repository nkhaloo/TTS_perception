<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI-generated Voices Experiment</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
    button { padding: 10px 20px; font-size: 16px; margin: 5px; }
    #progressContainer { width: 80%; background-color: #eee; height: 10px; margin: 20px auto; border-radius: 5px; }
    #progressBar { height: 10px; background-color: #4CAF50; width: 0%; border-radius: 5px; }
    .slide { display: none; margin-top: 20px; }
    #choiceContainer { text-align: left; display: inline-block; margin-bottom: 20px; }
    #sliderWrapper { width: 60%; margin: 10px auto; }
    input[type="range"] { width: 100%; }
    .sliderValue { margin-top: 5px; font-weight: bold; }
  </style>
</head>
<body>
  <!-- Welcome Slide -->
  <div id="welcomeSlide" class="slide" style="display:block;">
    <h2>Welcome!</h2>
    <button id="welcomeNextBtn">Next</button>
  </div>
  <!-- Intro Instructions -->
  <div id="instructionsSlide1" class="slide">
    <p>This study is about exploring what influences our perception of social categories in AI-generated speech. You will hear 14 AI-generated voices reading the same passage. After each, you will answer some questions about the voice.</p>
    <button id="instructions1NextBtn">Next</button>
  </div>
  <!-- Detail Instructions -->
  <div id="instructionsSlide2" class="slide">
    <p>Please pay close attention to each speaker and answer each question carefully.</p>
    <button id="instructions2NextBtn">Begin</button>
  </div>
  <!-- Attention Check -->
  <div id="attentionSlide" class="slide">
    <audio id="attentionAudio"></audio>
    <p>What animal did you just hear?</p>
    <button class="attentionBtn">Dog</button>
    <button class="attentionBtn">Cat</button>
    <button class="attentionBtn">Bird</button>
    <button class="attentionBtn">Monkey</button>
  </div>
  <!-- Play Audio -->
  <div id="experimentSlide" class="slide">
    <audio id="audioPlayer"></audio>
    <div>
      <button id="playBtn">Play Audio</button>
      <button id="skipBtn" style="display:none;">Skip (Pilot Only)</button>
    </div>
    <div id="progressContainer"><div id="progressBar"></div></div>
  </div>
  <!-- Ethnicity -->
  <div id="ethnicitySlide" class="slide">
    <p>What is the ethnicity of the voice?</p>
    <div id="choiceContainer">
      <label><input type="radio" name="ethnicity" value="White American"> White American</label><br>
      <label><input type="radio" name="ethnicity" value="African American"> African American</label><br>
      <label><input type="radio" name="ethnicity" value="Asian American"> Asian American</label><br>
      <label><input type="radio" name="ethnicity" value="Mexican American"> Mexican American</label>
    </div>
    <button id="ethnicityNextBtn">Next</button>
  </div>
  <!-- Certainty Ethnicity -->
  <div id="certaintySlide" class="slide">
    <p>On a scale of 1 (least certain) to 10 (most certain), how certain are you of your previous answer?</p>
    <div id="sliderWrapper">
      <input type="range" id="certaintySlider" min="1" max="10" step="0.5" value="5.5">
      <div id="certaintySliderValue" class="sliderValue">5.5</div>
    </div>
    <button id="certaintyContinueBtn">Next</button>
  </div>
  <!-- Gender -->
  <div id="genderSlide" class="slide">
    <p>What gender is this speaker?</p>
    <div id="choiceContainer">
      <label><input type="radio" name="gender" value="Male"> Male</label><br>
      <label><input type="radio" name="gender" value="Female"> Female</label><br>
      <label><input type="radio" name="gender" value="Not sure"> Not sure</label>
    </div>
    <button id="genderNextBtn">Next</button>
  </div>
  <!-- Certainty Gender -->
  <div id="genderCertaintySlide" class="slide">
    <p>On a scale of 1 (least certain) to 10 (most certain), how certain are you?</p>
    <div id="sliderWrapper">
      <input type="range" id="genderCertaintySlider" min="1" max="10" step="0.5" value="5.5">
      <div id="genderCertaintySliderValue" class="sliderValue">5.5</div>
    </div>
    <button id="genderContinueBtn">Next</button>
  </div>
  <!-- Energy -->
  <div id="energySlide" class="slide">
    <p>How energetic did this speaker sound?</p>
    <div id="choiceContainer">
      <label><input type="radio" name="energy" value="Very energetic"> Very energetic</label><br>
      <label><input type="radio" name="energy" value="Somewhat energetic"> Somewhat energetic</label><br>
      <label><input type="radio" name="energy" value="Not energetic at all"> Not energetic at all</label>
    </div>
    <button id="energyNextBtn">Next</button>
  </div>
  <!-- Certainty Energy -->
  <div id="energyCertaintySlide" class="slide">
    <p>On a scale of 1 (least certain) to 10 (most certain), how certain are you?</p>
    <div id="sliderWrapper">
      <input type="range" id="energyCertaintySlider" min="1" max="10" step="0.5" value="5.5">
      <div id="energyCertaintySliderValue" class="sliderValue">5.5</div>
    </div>
    <button id="energyContinueBtn">Next</button>
  </div>
  <!-- Age -->
  <div id="ageSlide" class="slide">
    <p>About how old did this speaker sound?</p>
    <div id="choiceContainer">
      <label><input type="radio" name="age" value="0-20"> 0-20</label><br>
      <label><input type="radio" name="age" value="20-40"> 20-40</label><br>
      <label><input type="radio" name="age" value="40-60"> 40-60</label><br>
      <label><input type="radio" name="age" value="60-80"> 60-80</label>
    </div>
    <button id="ageNextBtn">Next</button>
  </div>
  <!-- Certainty Age -->
  <div id="ageCertaintySlide" class="slide">
    <p>On a scale of 1 (least certain) to 10 (most certain), how certain are you?</p>
    <div id="sliderWrapper">
      <input type="range" id="ageCertaintySlider" min="1" max="10" step="0.5" value="5.5">
      <div id="ageCertaintySliderValue" class="sliderValue">5.5</div>
    </div>
    <button id="ageContinueBtn">Continue</button>
  </div>
  <!-- Conclusion -->
  <div id="conclusionSlide" class="slide">
    <h2>All done!</h2>
    <p>Thanks for participating.</p>
  </div>
<script>
  const mainAudioFiles = [...Array(7).keys()].flatMap(i => [`BM${i+1}.wav`,`BF${i+1}.wav`,`WM${i+1}.wav`,`WF${i+1}.wav`]);
  const shuffled = mainAudioFiles.sort(() => 0.5 - Math.random()).slice(0,14);
  const trialOrder = ["attention_check/cat.wav", ...shuffled, "attention_check/dog.wav"];
  let currentTrial = 0;
  let responses = {};

  function showSlide(id) {
    document.querySelectorAll('.slide').forEach(s => s.style.display='none');
    document.getElementById(id).style.display='block';
  }

  document.getElementById('welcomeNextBtn').onclick = () => showSlide('instructionsSlide1');
  document.getElementById('instructions1NextBtn').onclick = () => showSlide('instructionsSlide2');
  document.getElementById('instructions2NextBtn').onclick = () => runTrial();
  document.querySelectorAll('.attentionBtn').forEach(btn => btn.onclick = () => { currentTrial++; runTrial(); });

  const audioPlayer = document.getElementById('audioPlayer');
  const playBtn = document.getElementById('playBtn');
  const skipBtn = document.getElementById('skipBtn');
  const progressBar = document.getElementById('progressBar');
  let progressInterval;
  playBtn.onclick = () => { audioPlayer.play(); playBtn.style.display='none'; skipBtn.style.display='inline'; progressInterval = setInterval(() => progressBar.style.width = audioPlayer.currentTime/audioPlayer.duration*100+'%',200); };
  skipBtn.onclick = () => { audioPlayer.pause(); clearInterval(progressInterval); progressBar.style.width='0%'; showSlide('ethnicitySlide'); };
  audioPlayer.onended = () => { clearInterval(progressInterval); progressBar.style.width = '100%'; showSlide('ethnicitySlide'); };

  function runTrial(){
    if(currentTrial>=trialOrder.length) return showSlide('conclusionSlide');
    const file=trialOrder[currentTrial];
    if(file.includes('attention_check')){ showSlide('attentionSlide'); document.getElementById('attentionAudio').src=file; document.getElementById('attentionAudio').play(); }
    else{ showSlide('experimentSlide'); audioPlayer.src='../data/soundfiles/'+file; playBtn.style.display='inline'; skipBtn.style.display='none'; progressBar.style.width='0%'; }
  }

  function setupMC(btnId, respKey, nextSlide){
    document.getElementById(btnId).onclick = () => {
      const name = btnId.replace('NextBtn','');
      const sel = document.querySelector(`input[name="${name}"]:checked`);
      if(!sel) return alert('Please make a selection.');
      responses[respKey]=sel.value;
      showSlide(nextSlide);
    };
  }
  setupMC('ethnicityNextBtn','ethnicity','certaintySlide');
  setupMC('genderNextBtn','gender','genderCertaintySlide');
  setupMC('energyNextBtn','energy','energyCertaintySlide');
  setupMC('ageNextBtn','age','ageCertaintySlide');

  function setupCertainty(sliderId, displayId, btnId, nextSlide){
    document.getElementById(sliderId).oninput = e => { document.getElementById(displayId).textContent = e.target.value; };
    document.getElementById(btnId).onclick = () => {
      responses[sliderId.replace('CertaintySlider','')+'Certainty'] = document.getElementById(sliderId).value;
      if(nextSlide==='experimentSlide'){ console.log({...responses,file:trialOrder[currentTrial]}); responses={}; currentTrial++; }
      showSlide(nextSlide);
    };
  }
  setupCertainty('certaintySlider','certaintySliderValue','certaintyContinueBtn','genderSlide');
  setupCertainty('genderCertaintySlider','genderCertaintySliderValue','genderContinueBtn','energySlide');
  setupCertainty('energyCertaintySlider','energyCertaintySliderValue','energyContinueBtn','ageSlide');
  setupCertainty('ageCertaintySlider','ageCertaintySliderValue','ageContinueBtn','experimentSlide');
</script>
</body>
</html>
